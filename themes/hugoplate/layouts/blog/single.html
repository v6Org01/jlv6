{{ define "main" }}
  <section class="section pt-7">
    <div class="container">
      <div class="row justify-center">
        <article class="lg:col-10">
          {{ $image_light := .Params.image_light }}
          {{ $image_dark := .Params.image_dark }}

          {{ if or $image_light $image_dark }}
            <div class="mb-10 relative">
              <!-- Light & Dark Mode Images with unique class for the blog post -->
              {{ if $image_light }}
                {{ partial "image" (dict "Src" $image_light "Class" "post-image img-light w-full rounded" "Alt" .Title "DisplayXL" "2000x" "DisplayLG" "1500x" "DisplayMD" "1200x") }}
              {{ end }}
              {{ if $image_dark }}
                {{ partial "image" (dict "Src" $image_dark "Class" "post-image img-dark w-full rounded hidden" "Alt" .Title "DisplayXL" "2000x" "DisplayLG" "1500x" "DisplayMD" "1200x") }}
              {{ end }}
            </div>
          {{ end }}

          <h4 class="h4 mb-4">
            {{ .Title }}
          </h4>
          <ul class="mb-4">
            {{ $categories:= .Params.categories }}
            {{ if $categories }}
              <li class="mr-4 inline-block">
                <i class="fa-regular fa-folder mr-2"></i>
                {{ range $i,$p:= $categories }}
                  <a
                    href="{{ `categories/` | relLangURL }}{{ . | urlize | lower }}/"
                    class=""
                    >{{ . | humanize }}{{ if ne $i (sub (len $categories) 1) }}
                      {{ "," }}
                    {{ end }}
                  </a>
                {{ end }}
              </li>
            {{ end }}
            <li class="mr-4 inline-block">
              <i class="fa-regular fa-clock mr-2"></i>
              {{ time.Format ":date_long" .PublishDate }}
            </li>
          </ul>
          <div class="content mb-10">
          <!-- {{ partial "toc.html" (dict "Class" "blog" "Collapsed" true "TableOfContents" .TableOfContents ) }} -->
            {{ .Content }}
          </div>
          <!-- comments -->
          {{ if site.Config.Services.Disqus.Shortname }}
            <div class="mt-20">
              {{ template "_internal/disqus.html" . }}
            </div>
          {{ end }}
        </article>
      </div>

      <!-- Related posts -->
      {{ $related := (where site.RegularPages "Section" "in" site.Params.mainSections) | intersect (where site.RegularPages ".Title" "!=" .Title) | union (site.RegularPages.Related . ) }}
      {{ $related = $related | shuffle | first 3 }}
      {{ with $related }}
        <div class="section pb-0">
          <h2 class="h3 mb-12">{{ T "related_posts" }}</h2>
          <div class="row">
            {{ range . }}
              <div class="lg:col-4 md:col-6 mb-14">
                {{ partial "components/blog-card" . }}
              </div>
            {{ end }}
          </div>
        </div>
      {{ end }}
    </div>
  </section>

  <!-- JavaScript for Theme-based Image Switching -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Target the specific images for the post
      var lightImage = document.querySelector(".post-image.img-light");
      var darkImage = document.querySelector(".post-image.img-dark");

      // Function to get the active image (visible one based on current theme)
      function getActiveImage() {
        var isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        // If dark mode, return dark image, otherwise return light image
        return isDarkMode ? darkImage : lightImage;
      }

      // Function to update image display when the theme changes
      function updateImageDisplay() {
        var isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (isDarkMode) {
          if (lightImage) lightImage.classList.add("hidden");
          if (darkImage) darkImage.classList.remove("hidden");
        } else {
          if (lightImage) lightImage.classList.remove("hidden");
          if (darkImage) darkImage.classList.add("hidden");
        }

      // Update images on page load and when theme changes
      updateImageDisplay();
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateImageDisplay);
      }
    });
  </script>
{{ end }}