{{ define "main" }}
  <section class="section pt-12">
    <div class="container">
      <div class="row gx-5">
        <!-- Main Content: Resource Content Area -->
        <div class="lg:col-9" id="resource-content">
          <!-- Default content or message when no resource is selected -->
          <h5>Select a resource from the sidebar to view its details.</h5>
        </div>

        <!-- Sidebar: Resources List -->
        <div class="lg:col-3">
          <div class="sidebar">
            <h5 class="mb-6">Resources</h5>
            <div class="bg-theme-light dark:bg-darkmode-theme-light rounded p-6">
            <ul class="space-y-4">
              {{ range $term, $pages := .Site.Taxonomies.resources }}
                <!-- Loop through each resource term and get its pages -->
                <li>
                  <a href="javascript:void(0)" class="resource-link" data-resource="{{ with index $pages 0 }}{{ .Permalink }}{{ end }}">
                    {{ $term }}
                  </a>
                </li>
              {{ end }}
            </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- JavaScript to handle AJAX content loading -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const resourceLinks = document.querySelectorAll(".resource-link");

      resourceLinks.forEach(function(link) {
        link.addEventListener("click", function() {
          const resourceUrl = link.getAttribute("data-resource");

          // Fetch the resource content dynamically using AJAX
          fetch(resourceUrl)
            .then(response => response.text())
            .then(data => {
              // Parse the fetched HTML
              const parser = new DOMParser();
              const doc = parser.parseFromString(data, 'text/html');
              
              // Extract the title and content from the fetched page
              const resourceTitle = doc.querySelector("h1, h2, .resource-title") ? doc.querySelector("h1, h2, .resource-title").innerText : "Untitled";
              const resourceContent = doc.querySelector(".main-content") ? doc.querySelector(".main-content").innerHTML : "<p>No content available for this resource.</p>";
              const grafanaDashboardUrl = doc.querySelector("h3") ? doc.querySelector("h3").innerHTML : "<p>No graph available.</p>";

              // Inject the title and content into the current page
              document.getElementById("resource-content").innerHTML = `
                <h4>${resourceTitle}</h4>
                <div class="resource-description">${resourceContent}</div>
                <div class="grafana-iframe-container">
                  <iframe id="grafanaDashboard" width="100%" height="600" frameborder="0" src="${grafanaDashboardUrl}"></iframe>
                </div>
              `;
            })
            .catch(error => {
              console.error('Error fetching resource:', error);
              alert("Failed to load resource content.");
            });
        });
      });
    });
  </script>

{{ end }}