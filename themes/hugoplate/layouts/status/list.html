{{ define "main" }}
  <section class="section pt-12">
    <div class="container">
      <div class="row gx-5">
        <!-- Main Content: Resource Content Area -->
        <div class="lg:col-9" id="resource-content">
          <!-- Default content or message when no resource is selected -->
        </div>

        <!-- Sidebar: Resources List -->
        <div class="lg:col-3">
          <div class="sidebar">
            <h5 class="mb-6">Resources</h5>
            <div class="bg-theme-light dark:bg-darkmode-theme-light rounded p-6">
            <ul class="space-y-4">
              {{ range $term, $pages := .Site.Taxonomies.resources }}
                <!-- Loop through each resource term and get its pages -->
                <li>
                  <a href="javascript:void(0)" class="resource-link" data-resource="{{ with index $pages 0 }}{{ .Permalink }}{{ end }}">
                    {{ $term }}
                  </a>
                </li>
              {{ end }}
            </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- JavaScript to handle AJAX content loading -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const resourceLinks = document.querySelectorAll(".resource-link");
    
      function loadResource(resourceUrl, clickedLink = null) {
        if (!resourceUrl) {
          console.error("No resource URL found.");
          return;
        }
    
        console.log("Fetching resource from:", resourceUrl); // Debugging line
    
        // Remove active class from all resource links
        resourceLinks.forEach(l => l.classList.remove("active-resource"));
    
        // Add active class to the clicked link (or default link on page load)
        if (clickedLink) {
          clickedLink.classList.add("active-resource");
        }
    
        fetch(resourceUrl)
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.text();
          })
          .then(data => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(data, "text/html");
    
            const resourceSections = doc.querySelectorAll(".main-content");
            const grafanaUrls = doc.querySelectorAll("h3");
    
            let contentHtml = "";
    
            resourceSections.forEach((section, index) => {
              const sectionContent = section.innerHTML.trim();
              const grafanaUrl = grafanaUrls[index] ? grafanaUrls[index].innerText.trim() : "";
    
              contentHtml += `<div class="resource-section">`;
    
              if (sectionContent) {
                contentHtml += `<div class="resource-description">${sectionContent}</div><br />`;
              }
    
              if (grafanaUrl) {
                contentHtml += `
                  <div class="grafana-iframe-container">
                    <iframe width="100%" height="600" frameborder="0" src="${grafanaUrl}"></iframe>
                  </div>
                `;
              }
    
              contentHtml += `</div><br />`;
            });
    
            document.getElementById("resource-content").innerHTML = contentHtml || "<p>No content available for this resource.</p>";
          })
          .catch(error => {
            console.error("Error fetching resource:", error);
            alert("Failed to load resource content.");
          });
      }
    
      // Find the resource link for "jlv6.com"
      let defaultResource = null;
    
      resourceLinks.forEach(link => {
        if (link.textContent.trim() === "jlv6.com") {
          defaultResource = link;
        }
      });
    
      // If "jlv6.com" exists, use it; otherwise, use the first resource
      const initialResource = defaultResource || resourceLinks[0];
    
      if (initialResource) {
        const initialResourceUrl = initialResource.getAttribute("data-resource");
        loadResource(initialResourceUrl, initialResource);
      }
    
      // Attach click events to each resource link
      resourceLinks.forEach(link => {
        link.addEventListener("click", function() {
          const resourceUrl = link.getAttribute("data-resource");
          loadResource(resourceUrl, link);
        });
      });
    });
  </script>

{{ end }}