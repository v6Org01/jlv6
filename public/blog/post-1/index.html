<!doctype html><html itemscope lang=en-us itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><meta name=theme-name content="hugoplate"><link rel="shortcut icon" href=/images/favicon_hu_e8dd22b27728c20f.png type=image/x-icon><link rel=icon href=/images/favicon_hu_e8dd22b27728c20f.png type=image/x-icon><link rel=icon type=image/png sizes=48x48 href=/images/favicon_hu_72c78c0bf2e62228.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon_hu_e8dd22b27728c20f.png><link rel=apple-touch-icon sizes=144x144 href=/images/favicon_hu_6867f1a7af5732d6.png><link rel=manifest href=/manifest.webmanifest><meta name=msapplication-TileColor content="#ddd"><meta name=theme-color content="#ffffff"><script>let indexURL="http://localhost:1313/searchindex.json",includeSectionsInSearch=["blog"],search_no_results="No results for",search_initial_message="Type something to search.."</script><meta http-equiv=x-dns-prefetch-control content="on"><link rel=preconnect href=https://use.fontawesome.com crossorigin><link rel=preconnect href=//cdnjs.cloudflare.com><link rel=preconnect href=//www.googletagmanager.com><link rel=preconnect href=//www.google-analytics.com><link rel=dns-prefetch href=https://use.fontawesome.com><link rel=dns-prefetch href=//ajax.googleapis.com><link rel=dns-prefetch href=//cdnjs.cloudflare.com><link rel=dns-prefetch href=//www.googletagmanager.com><link rel=dns-prefetch href=//www.google-analytics.com><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//connect.facebook.net><link rel=dns-prefetch href=//platform.linkedin.com><link rel=dns-prefetch href=//platform.twitter.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600&family=OpenSans:wght@500;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><link href="/css/style.min.7b6b983bb965429401e22d54816be6277f0190d1e9b45752b2226d5556602285.css" integrity="sha256-e2uYO7llQpQB4i1UgWvmJ38BkNHptFdSsiJtVVZgIoU=" rel=stylesheet><link defer async rel=stylesheet href="/css/style-lazy.min.5d85e889fd5f5b28f9387aeade847fcb0a66d76a99a985ab4cdae3d37cf21557.css" integrity="sha256-XYXoif1fWyj5OHrq3oR/ywpm12qZqYWrTNrj03zyFVc=" media=print onload='this.media="all",this.onload=null'></head><body><header class="header sticky top-0 z-30"><nav class="navbar container"><div class=order-0><a class="navbar-brand block" href=/><img fetchpriority=high decoding=async class="img img-light" width=66 height=49 src=/images/logo_jlv6_light_hu_ca8dfa5a9fbeede3.webp alt=jlv6.com onerror='this.onerror=null,this.src="/images/logo_jlv6_light_hu_b9f91c28a48d4073.png"'>
<img fetchpriority=high decoding=async class="img img-dark" width=66 height=49 src=/images/logo_jlv6_dark_hu_33335d81d3de993b.webp alt=jlv6.com onerror='this.onerror=null,this.src="/images/logo_jlv6_dark_hu_4bbfce968dbfdf19.png"'></a></div><input id=nav-toggle type=checkbox class=hidden>
<label for=nav-toggle class="order-3 cursor-pointer flex items-center lg:hidden text-dark dark:text-white lg:order-1"><svg id="show-button" class="h-6 fill-current block" viewBox="0 0 20 20"><title>Menu Open</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0V0z"/></svg><svg id="hide-button" class="h-6 fill-current hidden" viewBox="0 0 20 20"><title>Menu Close</title><polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"/></svg></label><ul id=nav-menu class="navbar-nav order-3 hidden lg:flex w-full pb-6 lg:order-1 lg:w-auto lg:space-x-2 lg:pb-0 xl:space-x-8"><li class=nav-item><a class=nav-link href=/>Home</a></li><li class=nav-item><a class=nav-link href=/blog>Blog</a></li><li class=nav-item><a class=nav-link href=/status>Status</a></li><li class=nav-item><a class=nav-link href=/about>About Me</a></li><li class="mt-4 inline-block lg:hidden"><a class="btn btn-outline-primary btn-sm" href=https://dashboard.jlv6.com>Dashboard</a></li></ul><div class="order-1 ml-auto flex items-center md:order-2 lg:ml-0"><button aria-label=search class="border-border text-dark hover:text-primary dark:border-darkmode-border mr-5 inline-block border-r pr-5 text-xl dark:text-white dark:hover:text-darkmode-primary" data-target=search-modal>
<i class="fa-solid fa-search"></i></button><div class="theme-switcher mr-5 hidden"><input id=theme-switcher data-theme-switcher type=checkbox>
<label for=theme-switcher><span class=sr-only>theme switcher</span>
<span><svg class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10 opacity-100 dark:opacity-0" viewBox="0 0 56 56" fill="#fff" height="16" width="16"><path d="M30 4.6c0-1-.9-2-2-2a2 2 0 00-2 2v5c0 1 .9 2 2 2s2-1 2-2zm9.6 9a2 2 0 000 2.8c.8.8 2 .8 2.9.0L46 13a2 2 0 000-2.9 2 2 0 00-3 0zm-26 2.8c.7.8 2 .8 2.8.0.8-.7.8-2 0-2.9L13 10c-.7-.7-2-.8-2.9.0-.7.8-.7 2.1.0 3zM28 16A12 12 0 0016 28a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0028 16zm23.3 14c1.1.0 2-.9 2-2s-.9-2-2-2h-4.9a2 2 0 00-2 2c0 1.1 1 2 2 2zM4.7 26a2 2 0 00-2 2c0 1.1.9 2 2 2h4.9c1 0 2-.9 2-2s-1-2-2-2zm37.8 13.6a2 2 0 00-3 0 2 2 0 000 2.9l3.6 3.5a2 2 0 002.9.0c.8-.8.8-2.1.0-3zM10 43.1a2 2 0 000 2.9c.8.7 2.1.8 3 0l3.4-3.5c.8-.8.8-2.1.0-2.9s-2-.8-2.9.0zm20 3.4c0-1.1-.9-2-2-2a2 2 0 00-2 2v4.9c0 1 .9 2 2 2s2-1 2-2z"/></svg><svg class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10 opacity-0 dark:opacity-100" viewBox="0 0 24 24" fill="none" height="16" width="16"><path fill="#000" fill-rule="evenodd" clip-rule="evenodd" d="M8.2 2.2c1-.4 2 .6 1.6 1.5-1 3-.4 6.4 1.8 8.7a8.4 8.4.0 008.7 1.8c1-.3 2 .5 1.5 1.5v.1A10.3 10.3.0 0112.4 22 10.3 10.3.0 013.2 6.7c1-2 2.9-3.5 4.9-4.4z"/></svg></span></label></div><script>var darkMode=!1;window.matchMedia("(prefers-color-scheme: dark)").matches&&(darkMode=!0),localStorage.getItem("theme")==="dark"?darkMode=!0:localStorage.getItem("theme")==="light"&&(darkMode=!1),darkMode?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),document.addEventListener("DOMContentLoaded",()=>{var e=document.querySelectorAll("[data-theme-switcher]"),t=document.querySelector(".theme-switcher");[].forEach.call(e,function(e){e.checked=darkMode,e.addEventListener("click",()=>{document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light")})}),t.classList.remove("hidden")})</script><a href=https://dashboard.jlv6.com target=_blank rel=noopener class="btn btn-outline-primary btn-sm hidden lg:inline-block">Dashboard</a></div></nav></header><div class=search-modal aria-hidden=true style=--color-primary:#121212><div data-target=close-search-modal class=search-modal-overlay></div><div class=search-wrapper data-image=true data-description=true data-tags=true data-categories=true><div class=search-wrapper-header><label for=search-modal-input style=margin-top:-1px><span class=sr-only>search icon</span>
<svg viewBox="0 0 512 512" height="18" width="18" class="search-icon" data-type="search"><path fill="currentcolor" d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8.0 45.3s-32.8 12.5-45.3.0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9.0 208S93.1.0 208 0 416 93.1 416 208zM208 352a144 144 0 100-288 144 144 0 100 288z"/></svg>
<svg viewBox="0 0 512 512" height="18" width="18" class="search-reset" data-type="reset"><path fill="currentcolor" d="M256 512A256 256 0 10256 0a256 256 0 100 512zM175 175c9.4-9.4 24.6-9.4 33.9.0l47 47 47-47c9.4-9.4 24.6-9.4 33.9.0s9.4 24.6.0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6.0 33.9s-24.6 9.4-33.9.0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9.0s-9.4-24.6.0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6.0-33.9z"/></svg>
</label><input id=search-modal-input type=text data-search-input autocomplete=off aria-label=Search placeholder="Search Post..."></div><div class=search-wrapper-body><div class=search-result data-search-result></div><span class=search-result-empty>Type something to search..</span></div><div class=search-wrapper-footer><span><kbd><svg width="14" height="14" fill="currentcolor" viewBox="0 0 16 16"><path d="M3.204 11h9.592L8 5.519 3.204 11zm-.753-.659 4.796-5.48a1 1 0 011.506.0l4.796 5.48c.566.647.106 1.659-.753 1.659H3.204a1 1 0 01-.753-1.659z"/></svg>
</kbd><kbd><svg width="14" height="14" fill="currentcolor" style="margin-top:1px" viewBox="0 0 16 16"><path d="M3.204 5h9.592L8 10.481 3.204 5zm-.753.659 4.796 5.48a1 1 0 001.506.0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 00-.753 1.659z"/></svg>
</kbd>to navigate
</span><span><kbd><svg width="12" height="12" fill="currentcolor" style="display:inline-block" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M14.5 1.5a.5.5.0 01.5.5v4.8a2.5 2.5.0 01-2.5 2.5H2.707l3.347 3.346a.5.5.0 01-.708.708l-4.2-4.2a.5.5.0 010-.708l4-4a.5.5.0 11.708.708L2.707 8.3H12.5A1.5 1.5.0 0014 6.8V2a.5.5.0 01.5-.5z"/></svg>
</kbd>to select
</span><span class=search-result-info></span>
<span data-target=close-search-modal><kbd>ESC</kbd> to close</span></div></div></div><main><section class="section pt-7"><div class=container><div class="row justify-center"><article class=lg:col-10><div class="mb-10 relative"><picture><source srcset=/images/diag_observability_01_light_hu_f04a0284ba6f23d.webp media="(max-width: 575px)"><source srcset=/images/diag_observability_01_light_hu_eb1797d6d1ed1022.webp media="(max-width: 767px)"><source srcset=/images/diag_observability_01_light_hu_3b1a3a4eec454a60.webp media="(max-width: 991px)"><source srcset=/images/diag_observability_01_light_hu_3075fe77822e1be8.webp><img loading=lazy decoding=async src=/images/diag_observability_01_light_hu_c2ce767749fe8321.png class="post-image img-light w-full rounded img" alt="Using OpenTelemetry, OpenObserve, and Grafana to collect, transform, and visualize Logs, Metrics, and Traces" width=3456 height=2190>
</picture><picture><source srcset=/images/diag_observability_01_dark_hu_dc15cfb2f278f6f4.webp media="(max-width: 575px)"><source srcset=/images/diag_observability_01_dark_hu_931edda40dc8c0e2.webp media="(max-width: 767px)"><source srcset=/images/diag_observability_01_dark_hu_3d92048754317c8d.webp media="(max-width: 991px)"><source srcset=/images/diag_observability_01_dark_hu_68383920abd00291.webp><img loading=lazy decoding=async src=/images/diag_observability_01_dark_hu_215a1fc7f1a67667.png class="post-image img-dark w-full rounded hidden img" alt="Using OpenTelemetry, OpenObserve, and Grafana to collect, transform, and visualize Logs, Metrics, and Traces" width=3456 height=2190></picture></div><h4 class="h4 mb-4">Using OpenTelemetry, OpenObserve, and Grafana to collect, transform, and visualize Logs, Metrics, and Traces</h4><ul class=mb-4><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/observability/>Observability</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-clock mr-2"></i>
March 21, 2025</li></ul><div class="content mb-10"><br><h5 id=1-introduction>1. Introduction</h5><p>Since I’m hosting critical services—like a home automation platform, file storage, and photo storage—for people close to me, monitoring the health and performance of these systems is essential. With so many tools and services available today for logging, metrics, and tracing, it was quite a journey to select the individual components that eventually came together to form this observability stack. What began as a solution using the kube-prometheus-stack Helm chart and a wonky relay to forward AlertManager notifications to nfty.sh, eventually evolved into a more robust and scalable stack. The core of it consists of OpenTelemetry collectors, OpenObserve as the central monitoring hub, and Grafana to visualize and share the collected data.</p><h5 id=2-opentelemetry>2. OpenTelemetry</h5><p>The OpenTelemetry Operator has been deployed with ArgoCD using its Helm chart. The Operator manages OpenTelemetry Collector instances, which are created via the opentelemetrycollectors.opentelemetry.io Custom Resource Definition (CRD). I maintain manifests for the collectors and apply them manually. All collectors use the otel/opentelemetry-collector-contrib image and are configured to use the same exporter for sending the collected data.</p><div class=highlight><pre tabindex=0 style=color:#bbc3d4;background-color:#242933;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 1</span><span><span style=color:#5e81ac>spec</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 2</span><span>  <span style=color:#5e81ac>env</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 3</span><span>    - <span style=color:#5e81ac>name</span><span style=color:#eceff4>:</span> OPENOBSERVE_TOKEN
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 4</span><span>      <span style=color:#5e81ac>valueFrom</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 5</span><span>        <span style=color:#5e81ac>secretKeyRef</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 6</span><span>          <span style=color:#5e81ac>name</span><span style=color:#eceff4>:</span> opentelemetry-o2token
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 7</span><span>          <span style=color:#5e81ac>key</span><span style=color:#eceff4>:</span> o2token
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 8</span><span>  <span style=color:#5e81ac>config</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 9</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">10</span><span>    <span style=color:#5e81ac>exporters</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">11</span><span>      <span style=color:#5e81ac>otlp/openobserve</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">12</span><span>        <span style=color:#5e81ac>endpoint</span><span style=color:#eceff4>:</span> openobserve-router.ns.svc.cluster.local:5081
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">13</span><span>        <span style=color:#5e81ac>headers</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">14</span><span>          <span style=color:#5e81ac>Authorization</span><span style=color:#eceff4>:</span> <span style=color:#a3be8c>&#34;Basic ${env:OPENOBSERVE_TOKEN}&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">15</span><span>          <span style=color:#5e81ac>organization</span><span style=color:#eceff4>:</span> default
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">16</span><span>        <span style=color:#5e81ac>tls</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">17</span><span>          <span style=color:#5e81ac>insecure</span><span style=color:#eceff4>:</span> <span style=color:#d08770;font-weight:700>true</span>
</span></span></code></pre></div><p>A separate OpenTelemetry collector is created for each receiver, so as to help spread the load of collecting data:</p><ul><li>httpcheck: Collects health and performance metrics for HTTP endpoints.</li><li>k8s_cluster: Collects cluster-level metrics and entity events from the Kubernetes API server.</li><li>k8sobjects: Collects objects from the Kubernetes API server.</li><li>k8slog: Collects pod logs across all nodes (in daemonset-stdout mode).</li><li>kubeletstats: Collects node, pod, container, and volume metrics from the kubelet endpoint on each node.</li></ul><p>There isn’t much more to it to get started. I&rsquo;ll create separate blog posts to provide more details on how the collectors are configured and used.</p><h5 id=3-openobserve>3. OpenObserve</h5><p>OpenObserve serves as the central hub of my observability stack, offering a powerful, all-in-one solution for storing, querying, transforming and visualizing logs, metrics, and traces. While similar solutions offer feature parity with OpenObserve, it’s the ease of setup, simplicity in use, and fantastic out-of-the-box experience that truly sold me on it.</p><p>Another thing I appreciate about it is its scalability and performance. Its microservices-based architecture, with separate pods for the ingester, querier, router, alertmanager, NATS cluster, and compactor, allows each component to scale independently. Its ability to process and transform data using Pipelines and Functions is another big plus as it lets me filter, enrich, and reformat the incoming data before storing it.</p><p><img src=/images/scr_openobserve_logs_cloudfront_01.png alt=img>
<em>OpenObserve UI</em></p><h6 id=31-environment-variables>3.1 Environment Variables</h6><p>Here is the list of environment variables for which I changed the default values in the Helm chart values.yaml file:</p><div class=highlight><pre tabindex=0 style=color:#bbc3d4;background-color:#242933;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 1</span><span>ZO_CLUSTER_NAME: <span style=color:#a3be8c>&#34;o2-pluto&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 2</span><span>ZO_CLUSTER_COORDINATOR: <span style=color:#a3be8c>&#34;nats&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 3</span><span>ZO_COMPACT_DATA_RETENTION_DAYS: <span style=color:#a3be8c>&#34;30&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 4</span><span>ZO_LOCAL_MODE: <span style=color:#a3be8c>&#34;false&#34;</span>  <span style=color:#4c566a;font-style:italic>## false indicates cluster mode deployment which supports multiple nodes with different roles.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 5</span><span>ZO_META_STORE: <span style=color:#a3be8c>&#34;postgres&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 6</span><span>ZO_NATS_ADDR: <span style=color:#a3be8c>&#34;nats://openobserve-nats.ns.svc.cluster.local:4222&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 7</span><span>ZO_S3_PROVIDER: <span style=color:#a3be8c>&#34;minio&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 8</span><span>ZO_S3_SERVER_URL: <span style=color:#a3be8c>&#34;http://a-hl.ns.svc.cluster.local:9000&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 9</span><span>ZO_S3_REGION_NAME: <span style=color:#a3be8c>&#34;eu-west-01&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">10</span><span>ZO_S3_BUCKET_NAME: <span style=color:#a3be8c>&#34;openobserve&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">11</span><span>ZO_SMTP_ENABLED: <span style=color:#a3be8c>&#34;true&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">12</span><span>ZO_SMTP_HOST: <span style=color:#a3be8c>&#34;in-v3.mailjet.com&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">13</span><span>ZO_SMTP_PORT: <span style=color:#a3be8c>&#34;587&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">14</span><span>ZO_SMTP_FROM_EMAIL: <span style=color:#a3be8c>&#34;admin_noreply@jlv6.com&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">15</span><span>ZO_SMTP_ENCRYPTION: <span style=color:#a3be8c>&#34;starttls&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">16</span><span>ZO_TELEMETRY: <span style=color:#a3be8c>&#34;false&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">17</span><span>ZO_WEB_URL: <span style=color:#a3be8c>&#34;https://&lt;subdomain&gt;.jlv6.com&#34;</span>
</span></span></code></pre></div><p>The following keys exist in a Kubernetes secret named openobserve-secrets:</p><div class=highlight><pre tabindex=0 style=color:#bbc3d4;background-color:#242933;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 1</span><span>ZO_META_POSTGRES_DSN
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 2</span><span>ZO_REPORT_USER_EMAIL
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 3</span><span>ZO_REPORT_USER_PASSWORD
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 4</span><span>ZO_ROOT_USER_EMAIL
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 5</span><span>ZO_ROOT_USER_PASSWORD
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 6</span><span>ZO_S3_ACCESS_KEY
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 7</span><span>ZO_S3_SECRET_KEY
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 8</span><span>ZO_SMTP_PASSWORD
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 9</span><span>ZO_SMTP_USER_NAME
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">10</span><span>ZO_TRACING_HEADER_KEY
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">11</span><span>ZO_TRACING_HEADER_VALUE
</span></span></code></pre></div><h6 id=32-rbac--sso-limitations>3.2 RBAC & SSO limitations</h6><p>One of the more noticeable limitations with OpenObserve is that RBAC (Role-Based Access Control) and SSO (Single Sign-On) are enterprise-only features. While I understand that this is a common business model in the industry and that there needs to be a value-add for paying customers, it makes access management significantly more cumbersome in my setup. Because of this limitation:</p><ul><li><p>All the OpenObserve user accounts I&rsquo;ve created for authentication—including those for collectors, AWS services, and Grafana—have access to all data streams and other resources in the instance, as accounts can only be assigned the Admin role.</p></li><li><p>The Traefik Forward Auth middleware needs to be added to OpenObserve&rsquo;s UI IngressRoute to fulfill the Multi-Factor Authentication (MFA) requirement I have for all the core services I&rsquo;m hosting. As a result, users must authenticate twice: first by logging in via Authelia, which authenticates against an <a href=https://github.com/lldap/lldap target=_blank>LLDAP</a> backend, and then by authenticating again with a local OpenObserve user.</p></li></ul><h5 id=4-grafana>4. Grafana</h5><p>The only reason Grafana is part of the stack is because OpenObserve does not (yet) provide a secure way to share its dashboards with anonymous viewers or embed them in an iframe. Accessing the Grafana UI can only be done as an authenticated user from a device with an RFC1918 IP address, additional Traefik ingressRoutes have been created to allow access to public-dashboards from anywhere.</p><h6 id=41-configuration-file-grafanaini>4.1 Configuration file (grafana.ini)</h6><div class=highlight><pre tabindex=0 style=color:#bbc3d4;background-color:#242933;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 1</span><span><span style=color:#5e81ac>[</span>analytics<span style=color:#5e81ac>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 2</span><span>reporting_enabled <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 3</span><span>check_for_updates <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>false</span>  <span style=color:#4c566a;font-style:italic>## Updates managed via its Helm chart.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 5</span><span><span style=color:#5e81ac>[</span>date_formats<span style=color:#5e81ac>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 6</span><span>default_timezone <span style=color:#5e81ac>=</span> UTC
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 8</span><span><span style=color:#5e81ac>[</span>server<span style=color:#5e81ac>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 9</span><span>enable_gzip <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">10</span><span>protocol <span style=color:#5e81ac>=</span> http
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">11</span><span>http_addr <span style=color:#5e81ac>=</span> 0.0.0.0
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">12</span><span>http_port <span style=color:#5e81ac>=</span> <span style=color:#b48ead>3000</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">13</span><span>root_url <span style=color:#5e81ac>=</span> https://&lt;subdomain&gt;.jlv6.com
</span></span></code></pre></div><p>Grafana’s generic OAuth authentication method is used to enable Single Sign-On (SSO) for jlv6.com&rsquo;s LDAP users through its integration with the Authelia OIDC Provider. Authelia authenticates users against the LLDAP backend and provides Grafana with relevant details, such as group membership, allowing Grafana to assign roles to LDAP users based on this information.</p><div class=highlight><pre tabindex=0 style=color:#bbc3d4;background-color:#242933;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 1</span><span><span style=color:#5e81ac>[</span>auth.generic_oauth<span style=color:#5e81ac>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 2</span><span>enabled <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 3</span><span>name <span style=color:#5e81ac>=</span> Authelia
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 4</span><span>icon <span style=color:#5e81ac>=</span> signin
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 5</span><span>auto_login <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 6</span><span>client_id <span style=color:#5e81ac>=</span> grafana
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 7</span><span>client_secret <span style=color:#5e81ac>=</span> &lt;secret&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 8</span><span>scopes <span style=color:#5e81ac>=</span> openid profile email groups
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 9</span><span>empty_scopes <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">10</span><span>auth_url <span style=color:#5e81ac>=</span> https://.../api/oidc/authorization
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">11</span><span>token_url <span style=color:#5e81ac>=</span> https://.../api/oidc/token
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">12</span><span>api_url <span style=color:#5e81ac>=</span> https://.../api/oidc/userinfo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">13</span><span>login_attribute_path <span style=color:#5e81ac>=</span> preferred_username
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">14</span><span>name_attribute_path <span style=color:#5e81ac>=</span> name
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">15</span><span>groups_attribute_path <span style=color:#5e81ac>=</span> groups
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">16</span><span>role_attribute_path <span style=color:#5e81ac>=</span> contains<span style=color:#5e81ac>(</span>groups, <span style=color:#a3be8c>&#39;GrafanaAdmins&#39;</span><span style=color:#5e81ac>)</span> <span style=color:#5e81ac>&amp;&amp;</span> <span style=color:#a3be8c>&#39;Admin&#39;</span> <span style=color:#5e81ac>||</span> <span style=color:#a3be8c>&#39;Viewer&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">17</span><span>role_attribute_strict <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">18</span><span>allow_assign_grafana_admin <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">19</span><span>skip_org_role_sync <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">20</span><span>use_pkce <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>true</span>
</span></span></code></pre></div><p>When using Grafana -> PgBouncer -> PostgreSQL, it’s important to set binary_parameters=yes in the connection string. Without this setting, Grafana may log errors like &ldquo;unnamed prepared statement does not exist&rdquo;.</p><div class=highlight><pre tabindex=0 style=color:#bbc3d4;background-color:#242933;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">1</span><span><span style=color:#5e81ac>[</span>database<span style=color:#5e81ac>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">2</span><span>url <span style=color:#5e81ac>=</span> postgres://&lt;db_user&gt;:&lt;db_user_password&gt;@cloudnative-pg-black-pooler-rw.ns.svc.cluster.local:5432/&lt;database&gt;?sslmode<span style=color:#5e81ac>=</span>disable<span style=color:#eceff4>&amp;</span>binary_parameters<span style=color:#5e81ac>=</span>yes
</span></span></code></pre></div><p>Set allow_embedding to true in the security section to allow embedding dashboards in an iframe.</p><div class=highlight><pre tabindex=0 style=color:#bbc3d4;background-color:#242933;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">1</span><span><span style=color:#5e81ac>[</span>security<span style=color:#5e81ac>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">2</span><span>disable_initial_admin_creation <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">3</span><span>allow_embedding <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>true</span>
</span></span></code></pre></div><p>I go into more detail about the plugin section in the next blog section: <strong>Querying OpenObserve logs</strong>.</p><div class=highlight><pre tabindex=0 style=color:#bbc3d4;background-color:#242933;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">1</span><span><span style=color:#5e81ac>[</span>plugins<span style=color:#5e81ac>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">2</span><span>enable_alpha <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">3</span><span>app_tls_skip_verify_insecure <span style=color:#5e81ac>=</span> <span style=color:#5e81ac>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">4</span><span>allow_loading_unsigned_plugins <span style=color:#5e81ac>=</span> zinclabs_openobserve
</span></span></code></pre></div><h6 id=42-querying-openobserve-logs>4.2 Querying OpenObserve logs</h6><p>The team behind OpenObserve has dedicated a <a href=https://openobserve.ai/docs/operator-guide/grafana_plugin/#explore-logs target=_blank>documentation page</a> to installing and configuring their Grafana plugin. Looking through its GitHub repository’s issues tab, there are some longstanding open issues, but none of them are affecting me. To set it up, I added an initContainer to the Grafana deployment that pulls the plugin and installs it at /var/lib/grafana/plugins.</p><p>Once the plugin was installed, I added it in the Grafana UI as a new data source…
<img src=/images/scr_grafana_plugin_openobserve_01.png alt=img-50per>
<img src=/images/scr_grafana_plugin_openobserve_02.png alt=img-50per></p><h6 id=43-querying-openobserve-metrics>4.3 Querying OpenObserve metrics</h6><p>Since OpenObserve exposes metrics by default, all I had to do was add a data source of type Prometheus in Grafana, point it at OpenObserve&rsquo;s metric endpoint (<a href=http://openobserve-router.ns.svc.cluster.default:5080/api/default/prometheus%29 target=_blank>http://openobserve-router.ns.svc.cluster.default:5080/api/default/prometheus)</a>, and configure basic authentication.
<img src=/images/scr_grafana_openobserve_metrics_01.png alt=img-75per></p><h5 id=5-why-not-use-these-alternatives>5. Why not use these alternatives?</h5><p>As is often the case, there’s more than one way to skin a cat. Below, you’ll find a list of alternatives I’ve considered at various points during this process.</p><h6 id=51-opentelemetry-ebpf>5.1 OpenTelemetry-eBPF</h6><p>I wish I could have used OpenTelemetry-eBPF&rsquo;s kernel collector to gather low-level telemetry directly from the Linux kernel using eBPF. Unfortunately, the project doesn’t provide ARM64 images for its collectors, preventing me from deploying it across all nodes in my primary Kubernetes cluster. That said, <a href=https://github.com/open-telemetry/opentelemetry-network target=_blank>the project</a> is defintely worth checking out, as it also includes a Kubernetes and cloud collector, which enhance the collected telemetry with workload-specific metadata.</p><h6 id=52-aws-cloudwatch>5.2 AWS CloudWatch</h6><p>Although CloudWatch supports all the collectors I’m running, the costs associated with ingesting and storing logs, metrics, and traces from non-AWS services—along with the expenses for custom dashboards—make it too cost-prohibitive to be the central hub for monitoring activities.</p><h6 id=53-aws-cloudfront-standard-access-or-real-time-logs>5.3 AWS CloudFront standard access or real-time logs</h6><p>While I collect standard access logs for all CloudFront distributions in a centralized S3 bucket, I rarely use them. They’re nice to have for occasional queries, but from a monitoring perspective, I’m primarily interested in real-time logs.</p><p>Which brings us to the option of streaming real-time logs from CloudFront to OpenObserve using AWS Kinesis Firehose. It is the approach I’d recommend, as it provides all the essential data and is relatively easy to set up. Unfortunately, the cost of running even the smallest Firehose configuration (mode=provisioned, shard=1, retention_period=24hr) made it too cost-prohibitive for a hobby project. Even when limiting it to this site’s production distribution—with minimal traffic—I was accumulating an average cost of $5/day. For comparison, my total monthly AWS bill is less than $0.30.</p><p>If you’re interested in implementing this approach, I highly recommend checking out <a href=https://openobserve.ai/blog/monitor-cloudfront-access-logs-kinesis-streams-amazon-data-firehose-guide/ target=_blank>this blog post</a>. These are the code snippets I&rsquo;ve used to enable real-time logging according to the post, with Terraform&mldr;</p><details close><summary><b>Code snippets</b></summary><div class=highlight><pre tabindex=0 style=color:#bbc3d4;background-color:#242933;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-tf data-lang=tf><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">  1</span><span><span style=color:#d08770;font-weight:700>resource</span> <span style=color:#a3be8c>&#34;aws_kinesis_stream&#34;</span> <span style=color:#a3be8c>&#34;kinesis_stream_xx&#34;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">  2</span><span><span style=color:#d08770;font-weight:700>  provider</span>         <span style=color:#5e81ac>=</span> aws<span style=color:#eceff4>.</span>us_east_1
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">  3</span><span>  <span style=color:#8fbcbb>name</span>             = <span style=color:#a3be8c>&#34;cf-logs-jlv6-production&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">  4</span><span>  <span style=color:#8fbcbb>shard_count</span>      = <span style=color:#b48ead>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">  5</span><span>  <span style=color:#8fbcbb>retention_period</span> = <span style=color:#b48ead>24</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">  6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">  7</span><span>  stream_mode_details <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">  8</span><span>    <span style=color:#8fbcbb>stream_mode</span> = <span style=color:#a3be8c>&#34;PROVISIONED&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">  9</span><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 10</span><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 11</span><span><span style=color:#d08770;font-weight:700>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 12</span><span><span style=color:#d08770;font-weight:700>resource</span> <span style=color:#a3be8c>&#34;aws_kinesis_firehose_delivery_stream&#34;</span> <span style=color:#a3be8c>&#34;kinesis_firehose_stream_xx&#34;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 13</span><span><span style=color:#d08770;font-weight:700>  provider</span>    <span style=color:#5e81ac>=</span> aws<span style=color:#eceff4>.</span>us_east_1
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 15</span><span>  <span style=color:#8fbcbb>name</span>        = <span style=color:#a3be8c>&#34;cf-logs-jlv6-production&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 16</span><span>  <span style=color:#8fbcbb>destination</span> = <span style=color:#a3be8c>&#34;http_endpoint&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 18</span><span>  kinesis_source_configuration <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 19</span><span>    <span style=color:#8fbcbb>role_arn</span>           = aws_iam_role<span style=color:#eceff4>.</span>iam_role_xx<span style=color:#eceff4>.</span>arn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 20</span><span>    <span style=color:#8fbcbb>kinesis_stream_arn</span> = aws_kinesis_stream<span style=color:#eceff4>.</span>kinesis_stream_xx<span style=color:#eceff4>.</span>arn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 21</span><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 23</span><span>  http_endpoint_configuration <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 24</span><span>    <span style=color:#8fbcbb>url</span>                = <span style=color:#a3be8c>&#34;https://openobserve.jlv6.com/aws/default/cloudwatch_metrics/_kinesis_firehose&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 25</span><span>    <span style=color:#8fbcbb>name</span>               = <span style=color:#a3be8c>&#34;OpenObserve instance on Pluto&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 26</span><span>    <span style=color:#8fbcbb>access_key</span>         = <span style=color:#a3be8c>&#34;&lt;ACCESS_KEY&gt;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 27</span><span>    <span style=color:#8fbcbb>buffering_size</span>     = <span style=color:#b48ead>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 28</span><span>    <span style=color:#8fbcbb>buffering_interval</span> = <span style=color:#b48ead>60</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 29</span><span>    <span style=color:#8fbcbb>role_arn</span>           = aws_iam_role<span style=color:#eceff4>.</span>iam_role_xx<span style=color:#eceff4>.</span>arn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 30</span><span>    <span style=color:#8fbcbb>s3_backup_mode</span>     = <span style=color:#a3be8c>&#34;FailedDataOnly&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 32</span><span>    s3_configuration <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 33</span><span>      <span style=color:#8fbcbb>role_arn</span>           = aws_iam_role<span style=color:#eceff4>.</span>iam_role_xx<span style=color:#eceff4>.</span>arn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 34</span><span>      <span style=color:#8fbcbb>bucket_arn</span>         = <span style=color:#5e81ac>module</span><span style=color:#eceff4>.</span>s3_bucket_xx<span style=color:#eceff4>.</span>s3_bucket_arn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 35</span><span>      <span style=color:#8fbcbb>buffering_size</span>     = <span style=color:#b48ead>5</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 36</span><span>      <span style=color:#8fbcbb>buffering_interval</span> = <span style=color:#b48ead>300</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 37</span><span>      <span style=color:#8fbcbb>compression_format</span> = <span style=color:#a3be8c>&#34;GZIP&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 38</span><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 40</span><span>    processing_configuration <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 41</span><span>      <span style=color:#8fbcbb>enabled</span> = <span style=color:#a3be8c>&#34;true&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 42</span><span>      processors <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 43</span><span>        <span style=color:#8fbcbb>type</span> = <span style=color:#a3be8c>&#34;Lambda&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 44</span><span>        parameters <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 45</span><span>          <span style=color:#8fbcbb>parameter_name</span>  = <span style=color:#a3be8c>&#34;LambdaArn&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 46</span><span>          <span style=color:#8fbcbb>parameter_value</span> = <span style=color:#a3be8c>&#34;</span><span style=color:#a3be8c>${</span><span style=color:#5e81ac>module</span><span style=color:#eceff4>.</span>lambda_xx<span style=color:#eceff4>.</span>lambda_function_qualified_arn<span style=color:#a3be8c>}</span><span style=color:#a3be8c>&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 47</span><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 48</span><span>        parameters <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 49</span><span>          <span style=color:#8fbcbb>parameter_name</span>  = <span style=color:#a3be8c>&#34;BufferSizeInMBs&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 50</span><span>          <span style=color:#8fbcbb>parameter_value</span> = <span style=color:#a3be8c>&#34;3&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 51</span><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 52</span><span>        parameters <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 53</span><span>          <span style=color:#8fbcbb>parameter_name</span>  = <span style=color:#a3be8c>&#34;BufferIntervalInSeconds&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 54</span><span>          <span style=color:#8fbcbb>parameter_value</span> = <span style=color:#a3be8c>&#34;45&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 55</span><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 56</span><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 57</span><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 58</span><span>    request_configuration <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 59</span><span>      <span style=color:#8fbcbb>content_encoding</span> = <span style=color:#a3be8c>&#34;NONE&#34;</span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 60</span><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 61</span><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 62</span><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 63</span><span><span style=color:#d08770;font-weight:700>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 64</span><span><span style=color:#d08770;font-weight:700>resource</span> <span style=color:#a3be8c>&#34;aws_cloudfront_realtime_log_config&#34;</span> <span style=color:#a3be8c>&#34;cf_realtime_log_config_xx&#34;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 65</span><span><span style=color:#d08770;font-weight:700>  provider</span> <span style=color:#5e81ac>=</span> aws<span style=color:#eceff4>.</span>us_east_1
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 66</span><span>  <span style=color:#8fbcbb>depends_on</span> = <span style=color:#eceff4>[</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 67</span><span>    aws_iam_role<span style=color:#eceff4>.</span>iam_role_xx<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 68</span><span>    aws_kinesis_stream<span style=color:#eceff4>.</span>kinesis_stream_xx
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 69</span><span>  <span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 70</span><span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 71</span><span>  <span style=color:#8fbcbb>name</span>          = <span style=color:#a3be8c>&#34;jlv6-www&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 72</span><span>  <span style=color:#8fbcbb>sampling_rate</span> = <span style=color:#b48ead>100</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 73</span><span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 74</span><span>  <span style=color:#8fbcbb>fields</span> = <span style=color:#eceff4>[</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 75</span><span>    <span style=color:#a3be8c>&#34;timestamp&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 76</span><span>    <span style=color:#a3be8c>&#34;c-ip&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 77</span><span>    <span style=color:#a3be8c>&#34;cs-method&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 78</span><span>    <span style=color:#a3be8c>&#34;cs-uri-stem&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 79</span><span>    <span style=color:#a3be8c>&#34;sc-status&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 80</span><span>    <span style=color:#a3be8c>&#34;x-edge-result-type&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 81</span><span>    <span style=color:#a3be8c>&#34;x-edge-response-result-type&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 82</span><span>    <span style=color:#a3be8c>&#34;cs-user-agent&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 83</span><span>    <span style=color:#a3be8c>&#34;cs-referer&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 84</span><span>  <span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 85</span><span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 86</span><span>  endpoint <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 87</span><span>    <span style=color:#8fbcbb>stream_type</span> = <span style=color:#a3be8c>&#34;Kinesis&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 88</span><span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 89</span><span>    kinesis_stream_config <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 90</span><span>      <span style=color:#8fbcbb>role_arn</span>   = aws_iam_role<span style=color:#eceff4>.</span>iam_role_xx<span style=color:#eceff4>.</span>arn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 91</span><span>      <span style=color:#8fbcbb>stream_arn</span> = aws_kinesis_stream<span style=color:#eceff4>.</span>kinesis_stream_xx<span style=color:#eceff4>.</span>arn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 92</span><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 93</span><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 94</span><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 95</span><span><span style=color:#d08770;font-weight:700>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 96</span><span><span style=color:#d08770;font-weight:700>module</span> <span style=color:#a3be8c>&#34;cf_distribution_xx&#34;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 97</span><span>  <span style=color:#8fbcbb>source</span> = <span style=color:#a3be8c>&#34;terraform-aws-modules/cloudfront/aws&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 98</span><span>  <span style=color:#8fbcbb>providers</span> = <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a"> 99</span><span>    <span style=color:#8fbcbb>aws</span> = aws<span style=color:#eceff4>.</span>us_east_1
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">100</span><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">101</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">102</span><span>  <span style=color:#8fbcbb>aliases</span> = <span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;www.jlv6.com&#34;</span><span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">103</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">104</span><span>  <span style=color:#8fbcbb>comment</span>             = <span style=color:#a3be8c>&#34;Production distribution for www.jlv6.com&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">105</span><span>  <span style=color:#8fbcbb>enabled</span>             = <span style=color:#d08770;font-weight:700>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">106</span><span>  <span style=color:#8fbcbb>is_ipv6_enabled</span>     = <span style=color:#d08770;font-weight:700>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">107</span><span>  <span style=color:#8fbcbb>price_class</span>         = <span style=color:#a3be8c>&#34;PriceClass_100&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">108</span><span>  <span style=color:#8fbcbb>retain_on_delete</span>    = <span style=color:#d08770;font-weight:700>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">109</span><span>  <span style=color:#8fbcbb>wait_for_deployment</span> = <span style=color:#d08770;font-weight:700>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">110</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">111</span><span>  <span style=color:#8fbcbb>geo_restriction</span> = <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">112</span><span>    <span style=color:#8fbcbb>restriction_type</span> = <span style=color:#a3be8c>&#34;whitelist&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">113</span><span>    <span style=color:#8fbcbb>locations</span>        = <span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;US&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;CA&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;GB&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;DE&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;FR&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;BE&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;NL&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;LU&#34;</span><span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">114</span><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">115</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">116</span><span>  <span style=color:#8fbcbb>create_origin_access_identity</span> = <span style=color:#d08770;font-weight:700>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">117</span><span>  <span style=color:#8fbcbb>create_origin_access_control</span> = <span style=color:#d08770;font-weight:700>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">118</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">119</span><span>  <span style=color:#8fbcbb>logging_config</span> = <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">120</span><span>    <span style=color:#8fbcbb>bucket</span> = <span style=color:#5e81ac>data</span><span style=color:#eceff4>.</span>terraform_remote_state<span style=color:#eceff4>.</span>shared<span style=color:#eceff4>.</span>outputs<span style=color:#eceff4>.</span><span style=color:#5e81ac>module</span><span style=color:#c5727a>_</span>s3_bucket_xx_s3_bucket_bucket_domain_name
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">121</span><span>    <span style=color:#8fbcbb>prefix</span> = <span style=color:#a3be8c>&#34;cf_production&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">122</span><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">123</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">124</span><span>  <span style=color:#8fbcbb>origin</span> = <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">125</span><span>    <span style=color:#8fbcbb>primaryK8S</span> = <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">126</span><span>      <span style=color:#8fbcbb>domain_name</span> = <span style=color:#5e81ac>&lt;</span>subdomain<span style=color:#5e81ac>&gt;</span><span style=color:#eceff4>.</span>jlv6<span style=color:#eceff4>.</span>com
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">127</span><span>      <span style=color:#8fbcbb>custom_origin_config</span> = <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">128</span><span>        <span style=color:#8fbcbb>http_port</span>              = <span style=color:#b48ead>80</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">129</span><span>        <span style=color:#8fbcbb>https_port</span>             = <span style=color:#b48ead>443</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">130</span><span>        <span style=color:#8fbcbb>origin_protocol_policy</span> = <span style=color:#a3be8c>&#34;https-only&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">131</span><span>        <span style=color:#8fbcbb>origin_ssl_protocols</span>   = <span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;TLSv1.2&#34;</span><span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">132</span><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">133</span><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">134</span><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">135</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">136</span><span>  <span style=color:#8fbcbb>default_cache_behavior</span> = <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">137</span><span>    <span style=color:#8fbcbb>target_origin_id</span>       = <span style=color:#a3be8c>&#34;primaryK8S&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">138</span><span>    <span style=color:#8fbcbb>viewer_protocol_policy</span> = <span style=color:#a3be8c>&#34;https-only&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">139</span><span>    <span style=color:#8fbcbb>allowed_methods</span>        = <span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;GET&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;HEAD&#34;</span><span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">140</span><span>    <span style=color:#8fbcbb>cached_methods</span>         = <span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;GET&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;HEAD&#34;</span><span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">141</span><span>    <span style=color:#8fbcbb>compress</span>               = <span style=color:#d08770;font-weight:700>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">142</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">143</span><span>    <span style=color:#8fbcbb>use_forwarded_values</span>         = <span style=color:#d08770;font-weight:700>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">144</span><span>    <span style=color:#8fbcbb>cache_policy_id</span>              = <span style=color:#a3be8c>&#34;658327ea-f89d-4fab-a63d-7e88639e58f6&#34;</span><span style=color:#4c566a;font-style:italic> # Managed-CachingOptimized
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">145</span><span><span style=color:#4c566a;font-style:italic></span>    <span style=color:#8fbcbb>origin_request_policy_id</span>     = <span style=color:#a3be8c>&#34;33f36d7e-f396-46d9-90e0-52428a34d9dc&#34;</span><span style=color:#4c566a;font-style:italic> # Managed-AllViewerAndCloudFrontHeaders-2022-06
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">146</span><span><span style=color:#4c566a;font-style:italic></span>    <span style=color:#8fbcbb>response_headers_policy_id</span>   = <span style=color:#a3be8c>&#34;67f7725c-6f97-4210-82d7-5512b31e9d03&#34;</span><span style=color:#4c566a;font-style:italic> # Managed-SecurityHeadersPolicy
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">147</span><span><span style=color:#4c566a;font-style:italic></span>
</span></span><span style=display:flex;background-color:#393e47><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">148</span><span>    <span style=color:#8fbcbb>realtime_log_config_arn</span> = aws_cloudfront_realtime_log_config<span style=color:#eceff4>.</span>cf_realtime_log_config_xx<span style=color:#eceff4>.</span>arn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">149</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">150</span><span>    <span style=color:#8fbcbb>lambda_function_association</span> = <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">151</span><span>      viewer<span style=color:#5e81ac>-</span><span style=color:#8fbcbb>request</span> = <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">152</span><span>        <span style=color:#8fbcbb>include_body</span> = <span style=color:#d08770;font-weight:700>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">153</span><span>        <span style=color:#8fbcbb>lambda_arn</span>   = <span style=color:#5e81ac>data</span><span style=color:#eceff4>.</span>terraform_remote_state<span style=color:#eceff4>.</span>shared<span style=color:#eceff4>.</span>outputs<span style=color:#eceff4>.</span><span style=color:#5e81ac>module</span><span style=color:#c5727a>_</span>lambda_at_edge_xx_lambda_function_qualified_arn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">154</span><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">155</span><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">156</span><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">157</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">158</span><span>  <span style=color:#8fbcbb>viewer_certificate</span> = <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">159</span><span>    <span style=color:#8fbcbb>cloudfront_default_certificate</span> = <span style=color:#d08770;font-weight:700>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">160</span><span>    <span style=color:#8fbcbb>acm_certificate_arn</span>            = <span style=color:#5e81ac>data</span><span style=color:#eceff4>.</span>terraform_remote_state<span style=color:#eceff4>.</span>shared<span style=color:#eceff4>.</span>outputs<span style=color:#eceff4>.</span>aws_acm_certificate_certxx_arn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">161</span><span>    <span style=color:#8fbcbb>ssl_support_method</span>             = <span style=color:#a3be8c>&#34;sni-only&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">162</span><span>    <span style=color:#8fbcbb>minimum_protocol_version</span>       = <span style=color:#a3be8c>&#34;TLSv1.2_2021&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">163</span><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#5d616a">164</span><span><span style=color:#eceff4>}</span>
</span></span></code></pre></div></details><br><h6 id=54-grafana-cloud-free-tier>5.4 Grafana Cloud (free tier)</h6><p>While the free tier is quite generous, I quickly hit its 10K Metrics limit after choosing Grafana Cloud as the aggregator for all logs, metrics, and traces. I considered keeping it as part of the stack solely to share dashboards publicly, but the free hosted offering doesn’t seem to support that option. As a result, I opted to run an instance of Grafana OSS on Kubernetes, which allows me to set <code>allow_embedding = true</code> in its configuration file.</p><p>This concludes the blog post. If you have any questions, feel free to reach out at <a href=mailto:admin@jlv6.com>admin@jlv6.com</a>.</p></div></article></div></div></section><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".post-image.img-light"),t=document.querySelector(".post-image.img-dark");function s(){var n=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;return n?t:e}function n(){var s=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;s?(e&&e.classList.add("hidden"),t&&t.classList.remove("hidden")):(e&&e.classList.remove("hidden"),t&&t.classList.add("hidden")),n(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",n)}})</script></main><footer class="bg-theme-light dark:bg-darkmode-theme-light"></footer><script crossorigin=anonymous integrity="sha256-AsRBsTcNDXuNH3EdJ1ISJ1bJHb1MsTnRvYO+Xe1U5nw=" src=/js/script.min.02c441b1370d0d7b8d1f711d2752122756c91dbd4cb139d1bd83be5ded54e67c.js></script><script defer async crossorigin=anonymous integrity="sha256-6WomfiWXziApPR9exxy3xjT2w9Za+OYxJPD02L7xe5A=" src=/js/script-lazy.min.e96a267e2597ce20293d1f5ec71cb7c634f6c3d65af8e63124f0f4d8bef17b90.js></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js")</script></body></html>